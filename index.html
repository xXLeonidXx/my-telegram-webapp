<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Змейка с кнопками управления и выбором скорости</title>
  <style>
    canvas {
      border: 1px solid #000;
      display: block;
      margin: 20px auto;
      background: #eee;
    }
    .controls {
      text-align: center;
      margin-top: 10px;
    }
    .controls button,
    .controls select {
      font-size: 18px;
      margin: 5px;
      padding: 10px 15px;
      cursor: pointer;
    }
    #gameOverMessage {
      text-align: center;
      font-size: 24px;
      color: red;
      display: none;
      margin-top: 10px;
    }
    label {
      font-size: 18px;
      margin-right: 10px;
    }
  </style>
</head>
<body>

<canvas id="game" width="400" height="400"></canvas>

<div class="controls">
  <div>
    <label for="speedSelect">Скорость змейки (уровень):</label>
    <select id="speedSelect">
      <option value="300">1 (медленно)</option>
      <option value="270">2</option>
      <option value="240">3</option>
      <option value="210">4</option>
      <option value="180">5</option>
      <option value="150">6</option>
      <option value="120">7</option>
      <option value="90">8</option>
      <option value="60">9</option>
      <option value="30">10 (быстро)</option>
    </select>
  </div>

  <div>
    <button id="upBtn">↑ Вверх</button>
  </div>
  <div>
    <button id="leftBtn">← Влево</button>
    <button id="downBtn">↓ Вниз</button>
    <button id="rightBtn">→ Вправо</button>
  </div>
</div>

<div id="gameOverMessage">
  Игра окончена!<br/>
  <button id="restartBtn">Начать заново</button>
</div>

<script>
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const box = 20; // размер клетки

  let snake;
  let direction;
  let food;
  let gameInterval;
  let speed = 300; // стартовая скорость (мс)

  const gameOverMessage = document.getElementById('gameOverMessage');
  const restartBtn = document.getElementById('restartBtn');
  const speedSelect = document.getElementById('speedSelect');

  function init() {
    snake = [
      { x: 9 * box, y: 10 * box },
      { x: 8 * box, y: 10 * box },
      { x: 7 * box, y: 10 * box },
    ];
    direction = 'RIGHT';
    placeFood();
    gameOverMessage.style.display = 'none';

    if (gameInterval) clearInterval(gameInterval);
    gameInterval = setInterval(draw, speed);
  }

  function placeFood() {
    food = {
      x: Math.floor(Math.random() * 20) * box,
      y: Math.floor(Math.random() * 20) * box,
    };
  }

  function draw() {
    ctx.fillStyle = '#eee';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Рисуем еду
    ctx.fillStyle = 'red';
    ctx.fillRect(food.x, food.y, box, box);

    // Рисуем змейку
    for (let i = 0; i < snake.length; i++) {
      ctx.fillStyle = i === 0 ? 'green' : 'lime';
      ctx.fillRect(snake[i].x, snake[i].y, box, box);
      ctx.strokeStyle = '#000';
      ctx.strokeRect(snake[i].x, snake[i].y, box, box);
    }

    // Двигаем змейку
    let headX = snake[0].x;
    let headY = snake[0].y;

    if (direction === 'LEFT') headX -= box;
    else if (direction === 'RIGHT') headX += box;
    else if (direction === 'UP') headY -= box;
    else if (direction === 'DOWN') headY += box;

    // Проверка столкновений с границами и телом змейки
    if (
      headX < 0 ||
      headX >= canvas.width ||
      headY < 0 ||
      headY >= canvas.height ||
      collision(headX, headY, snake)
    ) {
      gameOver();
      return;
    }

    // Проверка съедания еды
    if (headX === food.x && headY === food.y) {
      // Не удаляем хвост — змейка растёт
      placeFood();
    } else {
      // Удаляем последний элемент
      snake.pop();
    }

    // Добавляем новую голову
    snake.unshift({ x: headX, y: headY });
  }

  function collision(x, y, array) {
    for (let i = 0; i < array.length; i++) {
      if (array[i].x === x && array[i].y === y) return true;
    }
    return false;
  }

  function gameOver() {
    clearInterval(gameInterval);
    gameOverMessage.style.display = 'block';
  }

  // Управление с клавиатуры
  document.addEventListener('keydown', e => {
    const key = e.key;
    if ((key === 'ArrowLeft' || key === 'a') && direction !== 'RIGHT') direction = 'LEFT';
    else if ((key === 'ArrowUp' || key === 'w') && direction !== 'DOWN') direction = 'UP';
    else if ((key === 'ArrowRight' || key === 'd') && direction !== 'LEFT') direction = 'RIGHT';
    else if ((key === 'ArrowDown' || key === 's') && direction !== 'UP') direction = 'DOWN';
  });

  // Управление кнопками
  document.getElementById('upBtn').addEventListener('click', () => {
    if (direction !== 'DOWN') direction = 'UP';
  });
  document.getElementById('downBtn').addEventListener('click', () => {
    if (direction !== 'UP') direction = 'DOWN';
  });
  document.getElementById('leftBtn').addEventListener('click', () => {
    if (direction !== 'RIGHT') direction = 'LEFT';
  });
  document.getElementById('rightBtn').addEventListener('click', () => {
    if (direction !== 'LEFT') direction = 'RIGHT';
  });

  // Кнопка начать заново
  restartBtn.addEventListener('click', () => {
    init();
  });

  // Обработка изменения скорости
  speedSelect.addEventListener('change', () => {
    speed = +speedSelect.value;
    // Перезапускаем игру с новой скоростью, если игра запущена
    if (gameInterval) {
      clearInterval(gameInterval);
      gameInterval = setInterval(draw, speed);
    }
  });

  // Запуск игры при загрузке страницы
  init();
</script>

</body>
</html>
